# 230919 ì‹±ê¸€í„´ íŒ¨í„´

í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ë§Œ ë§Œë“¤ê³ , ê·¸ ì¸ìŠ¤í„´ìŠ¤ì˜ ì „ì—­ ì ‘ê·¼ì„ ì œê³µí•œë‹¤.

# ê³ ì „ì  ì‹±ê¸€í„´ íŒ¨í„´ êµ¬í˜„ë²•

```java
public class Singleton {
	private static Singleton uniqueInstance;

	private Singleton() {} // privateìœ¼ë¡œ êµ¬í˜„í•´ì„œ ì´ í´ë˜ìŠ¤ì—ì„œ ë°–ì— ìƒì„±ì•ˆë˜ë„ë¡ ì œì–´

	public static Singleton getInstance(){
		if(uniqueInstance == null) {
			uniqueInstance = new Singleton();
		}
		return uniqueInstance;
	}

// ê¸°íƒ€ ë©”ì†Œë“œ

}
```

íŠ¹ì§•

- ì›í•˜ëŠ” ì‹œì ì— ê°ì²´ ìƒì„±ì´ ê°€ëŠ¥ (lazy instantiation)
- ë¹„ë™ê¸° ì‘ì—…ì„ í•  ë•Œ, ê°ì²´ì˜ ìœ ì¼ì„± ë³´ì¥ ë¶ˆê°€ (ì›ìì„± ê²°ì—¬)

## ë™ê¸°í™”

```java
public static synchronized Singleton getInstance(){

// ì¤‘ëµ

}
```

ë™ê¸°í™”ë¡œ ì¸í•´ ì†ë„ë¬¸ì œê°€ ìƒê¸´ë‹¤ë©´ ì•„ë˜ì˜ ìš°íšŒë°©ë²•ë„ ê³ ë ¤í•´ë³¼ë§Œí•˜ë‹¤.

1. ì²˜ìŒë¶€í„° ê°ì²´ ìƒì„±í•´ë‘ê¸°

```java
public class Singleton {
	private static Singleton uniqueInstance = new Singleton;

	private Singleton() {} // privateìœ¼ë¡œ êµ¬í˜„í•´ì„œ ì´ í´ë˜ìŠ¤ì—ì„œ ë°–ì— ìƒì„±ì•ˆë˜ë„ë¡ ì œì–´

	public static Singleton getInstance(){
		return uniqueInstance;
	}

// ê¸°íƒ€ ë©”ì†Œë“œ

}
```

1. DCLì„ ì‚¬ìš©í•˜ì—¬ ë™ê¸°í™” ì¤„ì´ê¸°
    1. ì—†ì„ì‹œì ì—ë§Œ ë™ê¸°í™”ë¥¼ í•˜ì—¬ ë¹„íš¨ìœ¨ì„±ì„ ì¤„ì„

```java
public class Singleton {
	private volatile static Singleton uniqueInstance;

	private Singleton() {} // privateìœ¼ë¡œ êµ¬í˜„í•´ì„œ ì´ í´ë˜ìŠ¤ì—ì„œ ë°–ì— ìƒì„±ì•ˆë˜ë„ë¡ ì œì–´

	public static Singleton getInstance(){
		if(uniqueInstance == null) {
			sychronized (Singletone class) {
				if(uniqueInstance == null) {
					uniqueInstance = new Singleton();
				}
			}
		}
		return uniqueInstance;
	}

// ê¸°íƒ€ ë©”ì†Œë“œ

}
```

# ì¥ë‹¨ì 

- ì „ì—­ë³€ìˆ˜ì™€ ë‹¬ë¦¬ lazy instantiationê°€ëŠ¥
- í•˜ë‚˜ë¿ì¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì–´ë””ì„œë“  ì ‘ê·¼ ê°€ëŠ¥

- ë‹¨ì¼ ì±…ì„ ì›ì¹™ ìœ„ë°°
- ëŠìŠ¨í•œ ê²°í•© ì›ì¹™ ìœ„ë°°

# í•¨ê»˜ë³´ê¸°

## ì‹±ê¸€í†¤ íŒ¨í„´ì˜ 7ê°€ì§€ êµ¬í˜„ ë°©ì‹

<aside>
ğŸ’¡ [ì¶œì²˜](https://inpa.tistory.com/entry/GOF-%F0%9F%92%A0-%EC%8B%B1%EA%B8%80%ED%86%A4Singleton-%ED%8C%A8%ED%84%B4-%EA%BC%BC%EA%BC%BC%ED%95%98%EA%B2%8C-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90)

1. Eager Initialization
2. Static block initialization
3. Lazy initialization
4. Thread safe initialization
5. Double-Checked Locking
6. Bill Pugh Solution
7. Enum ì´ìš©
</aside>

## Eager Initialization

- ë™ê¸°í™”ë•Œ ì‚¬ìš©í•œ ë°©ë²• (p215)
- ë¦¬ì†ŒìŠ¤ê°€ í° ê°ì²´ë¼ë©´ ë‚­ë¹„

## Static block initialization

1. ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•˜ì§€ë§Œ ì—¬ì „íˆ ë¦¬ì†ŒìŠ¤ê°€ í¬ë‹¤ë©´ ë‚­ë¹„

```java
class Singleton {
    // ì‹±ê¸€í†¤ í´ë˜ìŠ¤ ê°ì²´ë¥¼ ë‹´ì„ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜
    private static Singleton instance;

    // ìƒì„±ìë¥¼ privateë¡œ ì„ ì–¸ (ì™¸ë¶€ì—ì„œ new ì‚¬ìš© X)
    private Singleton() {}
    
    // static ë¸”ë¡ì„ ì´ìš©í•´ ì˜ˆì™¸ ì²˜ë¦¬
    static {
        try {
            instance = new Singleton();
        } catch (Exception e) {
            throw new RuntimeException("ì‹±ê¸€í†¤ ê°ì²´ ìƒì„± ì˜¤ë¥˜");
        }
    }

    public static Singleton getInstance() {
        return instance;
    }
}
```

## Lazy initialization

- ê³ ì „ì ì¸ ì‹±ê¸€í„´ íŒ¨í„´ êµ¬í˜„ë²• (p207)

## Thread safe initialization

- ë©€í‹°ìŠ¤ë ˆë”© ë¬¸ì œ í•´ê²°í•˜ê¸° (p214)

## Double-Checked Locking

- DCL ì‚¬ìš©í•˜ê¸° (p216)

## Bill Pugh Solution

- ê¶Œì¥ë˜ëŠ” ë‘ê°€ì§€ ë°©ë²•ì¤‘ í•˜ë‚˜
- ë©€í‹°ì“°ë ˆë“œ í™˜ê²½ì—ì„œ ì•ˆì „í•˜ê³  Lazy Loading(ë‚˜ì¤‘ì— ê°ì²´ ìƒì„±) ë„ ê°€ëŠ¥í•œ ì™„ë²½í•œ ì‹±ê¸€í†¤ ê¸°ë²•
- í´ë˜ìŠ¤ ì•ˆì— ë‚´ë¶€ í´ë˜ìŠ¤(holder)ë¥¼ ë‘ì–´ JVMì˜ í´ë˜ìŠ¤ ë¡œë” ë§¤ì»¤ë‹ˆì¦˜ê³¼ í´ë˜ìŠ¤ê°€ ë¡œë“œë˜ëŠ” ì‹œì ì„ ì´ìš©í•œ ë°©ë²• (ìŠ¤ë ˆë“œ ì„¸ì´í”„í•¨)
- static ë©”ì†Œë“œì—ì„œëŠ” static ë©¤ë²„ë§Œì„ í˜¸ì¶œí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ staticìœ¼ë¡œ ì„¤ì •ì´ë°–ì—ë„ ë‚´ë¶€ í´ë˜ìŠ¤ì˜ ì¹˜ëª…ì ì¸ ë¬¸ì œì ì¸ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•˜ì—¬ ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ staticìœ¼ë¡œ ì„¤ì •
- ë‹¤ë§Œ í´ë¼ì´ì–¸íŠ¸ê°€ ì„ì˜ë¡œ ì‹±ê¸€í†¤ì„ íŒŒê´´í•  ìˆ˜ ìˆë‹¤ëŠ” ë‹¨ì ì„ ì§€ë‹˜ (Reflection API, ì§ë ¬í™”/ì—­ì§ë ¬í™”ë¥¼ í†µí•´)

```java
class Singleton {

    private Singleton() {}

    // static ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ ì´ìš©
    // Holderë¡œ ë§Œë“¤ì–´, í´ë˜ìŠ¤ê°€ ë©”ëª¨ë¦¬ì— ë¡œë“œë˜ì§€ ì•Šê³  getInstance ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì–´ì•¼ ë¡œë“œë¨
    private static class SingleInstanceHolder {
        private static final Singleton INSTANCE = new Singleton();
    }

    public static Singleton getInstance() {
        return SingleInstanceHolder.INSTANCE;
    }
}
```

1. ìš°ì„  ë‚´ë¶€í´ë˜ìŠ¤ë¥¼ staticìœ¼ë¡œ ì„ ì–¸í•˜ì˜€ê¸° ë•Œë¬¸ì—, ì‹±ê¸€í†¤ í´ë˜ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì–´ë„ SingleInstanceHolder ë‚´ë¶€ í´ë˜ìŠ¤ëŠ” ë©”ëª¨ë¦¬ì— ë¡œë“œë˜ì§€ ì•ŠìŒ
2. ì–´ë– í•œ ëª¨ë“ˆì—ì„œÂ `getInstance()`Â ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ë•Œ, SingleInstanceHolder ë‚´ë¶€ í´ë˜ìŠ¤ì˜ static ë©¤ë²„ë¥¼ ê°€ì ¸ì™€ ë¦¬í„´í•˜ê²Œ ë˜ëŠ”ë°, ì´ë•Œ ë‚´ë¶€ í´ë˜ìŠ¤ê°€ í•œë²ˆë§Œ ì´ˆê¸°í™”ë˜ë©´ì„œ ì‹±ê¸€í†¤ ê°ì²´ë¥¼ ìµœì´ˆë¡œ ìƒì„± ë° ë¦¬í„´í•˜ê²Œ ëœë‹¤.
3. ë§ˆì§€ë§‰ìœ¼ë¡œ final ë¡œ ì§€ì •í•¨ìœ¼ë¡œì„œ ë‹¤ì‹œ ê°’ì´ í• ë‹¹ë˜ì§€ ì•Šë„ë¡ ë°©ì§€í•œë‹¤.

## Enum ì´ìš©

- enum ì‚¬ìš© ì‹±ê¸€í„´ (p219)

<aside>
ğŸ’¡ ì¦‰,

- LaszHolder : ì„±ëŠ¥ì´ ì¤‘ìš”ì‹œ ë˜ëŠ” í™˜ê²½
- Enum : ì§ë ¬í™”, ì•ˆì •ì„± ì¤‘ìš”ì‹œ ë˜ëŠ” í™˜ê²½
</aside>